DROP TABLE IF EXISTS Orders CASCADE;
DROP TABLE IF EXISTS OrderItems CASCADE;

/* Use Table Orders_Complete instead of Orders if you want to get the totalPrice of each Order */
CREATE TABLE IF NOT EXISTS Orders (
    id SERIAL PRIMARY KEY,
    customerId INTEGER NOT NULL,
    /*totalPrice DECIMAL(12, 2) NULL,*/

    FOREIGN KEY(customerId) REFERENCES Customers(id)
);

CREATE TABLE IF NOT EXISTS OrderItems (
    id SERIAL PRIMARY KEY,
    orderId INTEGER,
    productId INTEGER,
    quantity INTEGER
);

INSERT INTO Orders(customerId) VALUES
  (52),
  (75),
  (22),
  (91),
  (31),
  (96),
  (77),
  (67),
  (84),
  (76),
  (37),
  (50),
  (28),
  (96),
  (95),
  (79),
  (57),
  (91),
  (71),
  (46),
  (19),
  (90),
  (32),
  (33),
  (24),
  (65),
  (33),
  (30),
  (27),
  (21),
  (43),
  (78),
  (44),
  (83),
  (24),
  (93),
  (17),
  (25),
  (74),
  (27),
  (47),
  (39),
  (59),
  (9),
  (34),
  (78),
  (67),
  (58),
  (85),
  (32),
  (78),
  (23),
  (11),
  (96),
  (83),
  (84),
  (94),
  (68),
  (71),
  (82),
  (76),
  (63),
  (18),
  (43),
  (36),
  (42),
  (54),
  (25),
  (51),
  (69),
  (95),
  (32),
  (96),
  (5),
  (46),
  (81),
  (30),
  (68),
  (15),
  (34),
  (58),
  (4),
  (44),
  (13),
  (88),
  (19),
  (97),
  (70),
  (91),
  (34),
  (86),
  (61),
  (73),
  (46),
  (41),
  (80),
  (60),
  (6),
  (2),
  (66);

INSERT INTO OrderItems(orderId, productId, quantity) Values
  (40,1,1),
  (21,4,2),
  (34,10,2),
  (14,7,2),
  (44,2,2),
  (5,4,3),
  (42,2,2),
  (2,2,1),
  (18,3,2),
  (5,4,3),
  (24,5,1),
  (37,3,2),
  (24,4,2),
  (3,1,3),
  (35,8,1),
  (34,9,2),
  (22,6,2),
  (27,10,2),
  (44,3,1),
  (44,11,2),
  (47,8,2),
  (28,5,3),
  (39,6,2),
  (18,5,2),
  (18,6,2),
  (29,8,2),
  (40,8,2),
  (36,4,2),
  (4,2,1),
  (24,4,3),
  (45,8,2),
  (12,9,1),
  (42,5,2),
  (10,6,3),
  (40,9,3),
  (20,6,2),
  (23,10,2),
  (11,4,2),
  (1,2,3),
  (1,11,1),
  (45,1,2),
  (2,5,3),
  (13,3,1),
  (11,5,2),
  (38,4,1),
  (8,10,1),
  (37,4,1),
  (36,8,1),
  (12,11,2),
  (29,11,2),
  (4,4,1),
  (10,11,2),
  (32,3,3),
  (49,1,1),
  (6,1,3),
  (23,9,2),
  (45,10,2),
  (18,6,1),
  (10,1,2),
  (17,9,2),
  (21,10,3),
  (33,8,2),
  (15,8,2),
  (32,2,2),
  (23,11,2),
  (33,11,2),
  (18,8,1),
  (47,3,2),
  (45,10,2),
  (37,5,2),
  (47,9,2),
  (3,7,1),
  (49,2,2),
  (7,10,3),
  (25,3,2),
  (39,3,1),
  (4,4,3),
  (12,7,3),
  (5,7,2),
  (8,4,2),
  (50,10,3),
  (30,3,2),
  (45,9,2),
  (14,1,1),
  (42,7,2),
  (43,10,1),
  (23,9,1),
  (33,9,1),
  (29,5,3),
  (7,3,2),
  (45,10,1),
  (24,8,2),
  (39,2,3),
  (31,10,2),
  (47,6,2),
  (3,6,3),
  (21,7,2),
  (11,10,1),
  (5,9,3),
  (35,10,1);

DROP TABLE IF EXISTS OrderItems_Prices;
CREATE TABLE OrderItems_Prices AS
/* Cast in SELECT Statement not working; Result of calculation is an integer */
SELECT OrderItems.orderId as orderId, CAST(OrderItems.quantity AS DECIMAL(12, 2)) * Products.price AS price
FROM OrderItems, Products
WHERE OrderItems.productId = Products.id;


DROP TABLE IF EXISTS Orders_Complete;
CREATE TABLE Orders_Complete AS
SELECT Orders.id, Orders.customerId, SUM(OrderItems_Prices.price) as totalPrice
FROM Orders, OrderItems_Prices
WHERE Orders.id = OrderItems_Prices.orderId
GROUP BY Orders.id;
